<!DOCTYPE html>
<html lang="en">

<!-- 
Ann Maria Jiji
2227522
DISM2B04 
-->

<!--
    References:
    Photo by <a href="https://unsplash.com/@alexxsvch?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Alexey Savchenko</a> on <a href="https://unsplash.com/photos/k4Akpt5-Sfk?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>
  
-->


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
  
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    
    <!-- Javascripts   Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>
  
    <title>SP Games</title>
    <link rel="stylesheet" href="./css/commonStyles.css">
    <link rel="stylesheet" href="./css/imagesStyles.css">
    <link rel="stylesheet" href="./css/searchBox.css">
    
</head>

<!----------------------------------------------------------------------------------------------------------------------------------------------------------->

<body>
  <div class="main-container">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg" id="custom-navbar">
      <div id="brand">
        <a><i class="bi bi-joystick"></i>SP Games</a>
      </div>

      <div class="d-flex" id="elements">
        <a class="nav-link flex-fill" href="index.html">Home</a>
        <a class="nav-link flex-fill" href="#">Games</a>
        <a class="nav-link flex-fill" href="#">About</a>
        <a class="nav-link flex-fill" href="#">Contact</a>
        <button class="btn btn-primary flex-fill" id="button" onclick="window.location.href='login.html'">Login</button>
      </div>
    </nav>

    <!-- Main Content -->

    <!-- Full-width image -->
    <div class="full-width-image">
      <img src="./images/index_image.jpg" alt="Full Width Image">
      <div class="image-caption">
        <h1>Welcome to SP Games</h1>
        <p>Take your game to the next level.</p>
      </div>
    </div>

    <!-- Search Bar Section -->
    <div class="container mt-4">
      <form id="searchBar">
        <div class="blanks">
    
          <!-- search by game title -->
          <div class="col-md-4 mb-2">
            <input type="text" class="form-control rounded-pill mb-2" id="gameBlank" placeholder="Search by Game Title">
          </div>
    
          <!-- search by platform -->
          <div class="col-md-4 mb-2">
            <select class="rounded-pill" id="platformBlank" name="platform">
              <option value="" selected disabled hidden>Search by Platform</option>
    
              <!-- JS script below will dynamically populate the dropdown list -->
    
            </select>
          </div>
    
          <!-- search by category -->
          <div class="col-md-4 mb-2">
            <select class="rounded-pill" id="catBlank" name="category">
              <option value="" selected disabled hidden>Search by Category</option>
    
              <!-- JS script below will dynamically populate the dropdown list -->
    
            </select>
          </div>
          <button type="submit" class="btn btn-secondary mt-2" id="searchButton">Search</button>
        </div>
      </form>
    </div>

    <div class="game-grid">
      <!-- Search Results Header -->
      <h2 id="searchResultsHeader" class="mb-3">Search Results</h2>
      
      <!-- Container for game cards -->
      <div class="row" id="gameCardContainer">
        <!-- Game cards will be dynamically added here -->
      </div>
    </div>
    
    



    <!-- <div class="container mt-4">
            <div class="row" id="blanks">
              <div class="col-md-4 mb-2">
                <input type="text" class="form-control rounded-pill mb-2" id="gameBlank" placeholder="Search by Game Title">
              </div>
              <div class="col-md-4 mb-2">
                <input type="text" class="form-control rounded-pill mb-2" id="platformBlank" placeholder="Search by Game Title">
              </div>
              <div class="col-md-4 mb-2">
                <input type="text" class="form-control rounded-pill mb-2" id="catBlank" placeholder="Search by Category">
              </div>
            </div>
            <button type="button" class="btn btn-secondary mt-2" id="searchButton">Search</button>
        </div> -->

    <!-- <div class="container mt-4">
            <div class="row">
                Add game cards or information here
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="game1.jpg" class="card-img-top" alt="Game 1">
                        <div class="card-body">
                            <h5 class="card-title">Game 1</h5>
                            <p class="card-text">Description of Game 1.</p>
                            <a href="#" class="btn btn-primary">Play Game</a>
                        </div>
                    </div>
                </div>
    
                Add more game cards or information here
            </div>
        </div> -->

    <!-- Footer -->
    <footer class="custom-footer text-white text-center py-3">
      <p>&copy; 2023 SP Games Website.</p>
    </footer>

    <!-- Add Bootstrap JS scripts at the end of the body tag -->

  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous">
    </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  
  <!-- JS code -->

  <script>
    // fix base Url
    const baseUrl = "http://localhost:3000";


    //--------------------------------------------------------------
    // POPULATING DROPDOWN

    // initialising arrays
    let platforms = [];
    let categories = [];

    // get platform
    axios.get(`${baseUrl}/platform/`)

      // handling successful responses
      .then((response) => {
        platforms = response.data;

        // looping through the array
        platforms.forEach((platform) => {
          const platformHtml = `
              <option value="${platform.platform_name}">${platform.platform_name}</option>
              `;

          // adding to the html code
          $("#platformBlank").append(platformHtml);
        });
      })

      // handle error
      .catch((error) => {
        console.log(error);
      })


    // get category
    axios.get(`${baseUrl}/category/`)

      // handling successful responses
      .then((response) => {
        categories = response.data;

        // looping through the array
        categories.forEach((category) => {
          const catHtml = `
              <option value="${category.catname}">${category.catname}</option>
              `;

          // adding to the html code
          $("#catBlank").append(catHtml);
        });
      })

      // handle error
      .catch((error) => {
        console.log(error);
      });


    //----------------------------------------------------------------------------------------

    // MATCH THEN SEND QUERY

    $("#searchBar").submit((event) => {

      // prevent page reload
      event.preventDefault();

      // DISPLAYING
      let gameCardContainer = null;

      // function to create a single game card
      function createGameCard(game) {
            const gameCard = document.createElement('div');
            gameCard.classList.add('col-md-4', 'mb-3');

            const cardContent = `
            <div class="game-card">
              <img src="${baseUrl}/images/${game.image}" alt="Game Image">
              <h3 class="game-title">${game.title}</h3>
              <h4>${game.year}</h4>
              <h4>${game.platform}</h4>
              <h4>${game.category}</h4>
              <h4>${game.price}</h4>
              <a class="detailsLink" href='gameDetails?gameTitle=${game.title}&gameid=${game.gameid}&platformID=${game.platformid}&categoryID=${game.categoryid}'>View details</a>;
            </div>
            `;

            gameCard.innerHTML = cardContent;
            return gameCard;
          }

      // function to display cards in the container 
      function displayGameCards(results) {
        // results.forEach((game) => {
        //   const gameCard = createGameCard(game);
        //   gameCardContainer.appendChild(gameCard);
        // });

        // Clear any existing game cards
        gameCardContainer.innerHTML = "";

        // Check if there are results to display
        if (results.length === 0) {
          document.getElementById("searchResultsHeader").textContent = "No Results Found";
          return;
        }

        // Update the header text to display "Search Results"
        document.getElementById("searchResultsHeader").textContent = "Search Results";

        results.forEach((game) => {
          const gameCard = createGameCard(game);
          gameCardContainer.appendChild(gameCard);
        });
      }

    
      // extracting user input and changing it to JS
      var gameTitle = $("#gameBlank").val();
      var platformName = $("#platformBlank").val();
      var catName = $("#catBlank").val();

      console.log('platformName:', platformName);

      // // construct part of query
      // let query = `search?`;

      // match name to id only if its not an empty string
      let platformID = null;
      let categoryID = null;

      
      if (platformName != null) {
        // matching plaform name to id
        const tmp1 = platforms.find((platform) => platform.platform_name === platformName);
        platformID = tmp1.platformid;
      }

      if (catName != null) {
        // matching category name to id
        const tmp2 = categories.find((category) => category.catname === catName);
        categoryID = tmp2.categoryid;
      }

      // add to query if variable is not blank 

      if (gameTitle.trim().length === 0) {
        gameTitle = null;
      }

      // if (platformID != null) {
      //   if (gameTitle != '') {
      //     query += `&`
      //   }
      //   query += `platformID=${platformID}`;
      // } 

      // if (categoryID != null) {
      //   if (gameTitle != '' || platformID != null){
      //     query += `&`
      //   }
      //   query += `categoryID=${categoryID}`;
      // }

      const query = `search?gameTitle=${gameTitle}&platformID=${platformID}&categoryID=${categoryID}`;
      console.log(`the final query: ${query}`);

      // send to backend
      axios.get(`${baseUrl}/${query}`)

        //----------------------------------------------------------------------------------------
        // DISPLAY RESULTS

        // handling successful responses
        .then((response) => {

          // pass the data to a variable
          const data = response.data;

          // get the container element where game cards will be added
          gameCardContainer = document.getElementById("gameCardContainer");
          
          // call function to display game cards
          displayGameCards(data);

          // add a click event listener using event delegation
          // gameCardContainer.addEventListener('click', handleTitleClick);
          // gameCardContainer.addEventListener("click", handleTitleClick);
        })

        // catch errors
        .catch((error) => {

          // see what it looks like
          console.error();
      })
    });

 

    



  </script>


  </body>




</html>


