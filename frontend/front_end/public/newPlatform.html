<!DOCTYPE html>
<html lang="en">

<!-- 
Ann Maria Jiji
2227522
DISM2B04 
-->



<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
  
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    
    <!-- Javascripts   Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>
  
    <title>SP Games</title>
    <link rel="stylesheet" href="./css/commonStyles.css">
    
</head>
<body>
    <div class="main-container">
    
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg" id="custom-navbar">
            <div id="brand">
                <a><i class="bi bi-joystick"></i>SP Games</a>
            </div>
    
            <div class="d-flex" id="elements">
                <a class="nav-link flex-fill" href="adminHomePage.html">Admin Dashboard</a>
            </div>
        </nav>


        <h1 id="platformHead">Add a new platform</h1>

    <form class="platformForm">
        <div>
            <label for="platformName">Platform Name:</label>
            <input type="text" id="platformName" name="platformName" required>
        </div>
        <div>
            <label for="description">Description:</label>
            <textarea id="description" name="description" rows="4" ></textarea>
        </div>
        <div>
            <button type="submit">Add</button>
        </div>
    </form>
    </div>

    <script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- JS code -->

    <script>

        // fix base URL
        const baseUrl = "http://localhost:3000";

        // submits an event listener to the add platform form with respective id
        // so that when the form is submitted, the specific function is excuted
        $(".platformForm").submit((event) => {

            // prevent page reload
            event.preventDefault();

            // extracting user input and changing it to JS
            const platform_name = $("#platformName").val();
            const description = $("#description").val(); 
            console.log(platform_name, description)

            // this will be sent to the server in the POST request
            const requestBody = {
                type: "Admin",
                platform_name: platform_name,
                description: description
            };
            
            axios.post(`${baseUrl}/platform/`, requestBody)

                // handling successful responses
                .then((response) => {

                    console.log("response received")

                    // check for success
                    if (response.status === 201) {
                        alert(`Platform added successfully!`) // alert to show that game is added
                        window.location.href = '/newPlatform.html';
                    } 
                    // check for duplicate entry
                    else if (response.status === 422) {
                        alert(`Platform already exists! Please try a different name.`);
                    } 
                    // check for anything else
                    else {
                        alert(`Unexpected response: ${response.status}. Please try again.`);
                    }
                })
                .catch((error) => {

                    console.log("error received")
                    
                    alert(`Platform could not be added. Please try again!`)
                    consol.error();
                })

        })

    </script>
    
</body>
</html>
